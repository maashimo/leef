<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - leef üçÉ</title>
    <link rel="stylesheet" href="dashboard.css">
    <style>
        /* Top Navbar Styles */
        .top-navbar {
            background-color: rgba(10, 10, 10, 0.95);
            border-bottom: 1px solid #333;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .navbar-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .navbar-logo {
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
            color: #4ade80;
        }

        .navbar-location {
            font-size: 0.875rem;
            color: #6b7280;
            margin-left: 2rem;
        }

        .navbar-nav {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 2rem;
        }

        .navbar-link {
            text-decoration: none;
            color: #eee;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .navbar-link.active {
            background-color: #10b981;
            color: white;
        }

        .navbar-link:hover {
            background-color: #333;
        }

        @media (max-width: 768px) {
            .top-navbar {
                flex-direction: column;
                align-items: flex-start;
            }

            .navbar-nav {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>

<body class="">

    <!-- Top Navbar -->
    <nav class="top-navbar">
        <div class="navbar-header">
            <a href="index.html" class="navbar-logo">
                leef üçÉ
            </a>
            <div class="navbar-location">Colombo, Sri Lanka</div>
        </div>
        <ul class="navbar-nav">
            <li><a href="customer-dashboard-v3.html" class="navbar-link active">Dashboard</a></li>
            <li><a href="products.html" class="navbar-link">Products</a></li>
            <li><a href="cart.html" class="navbar-link ">Cart</a></li>

            <li><a href="feedback.html" class="navbar-link">Feedback</a></li>
            <li><a href="returns.html" class="navbar-link">Refund</a></li>
            <li><a href="profile.html" class="navbar-link ">Profile</a></li>
            <li><a href="index.html" class="navbar-link">Logout</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <div class="dashboard-header">
            <div>
                <h1 class="page-title">Welcome back!</h1>
                <p class="page-subtitle">Here's what's happening with your account</p>
            </div>
            <div class="header-actions">
                <!-- Notifications -->
                <div class="notifications">
                    <button class="btn btn-icon">üîî</button>
                    <span class="notification-count">4</span>
                </div>
                <!-- Chat Support -->
                <div class="chatbot-widget">
                    <button class="btn btn-primary">üí¨ Chat Support</button>
                </div>
            </div>
        </div>


        <!-- Featured Products -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">You may like</h2>
                <a href="products.html" class="link">View All ‚Üí</a>
            </div>
            <div class="products-grid" id="adsGrid"
                style="display:grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap:2em; margin-top:2em;">
                <div style="grid-column: 1/-1; text-align: center; color: #888;">Loading recommendations...</div>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", async () => {
                // User Name Logic
                try {
                    const user = JSON.parse(localStorage.getItem("user"));
                    // Permissive auth check - just try to get a name, don"t redirect
                    let displayName = "Customer";
                    if (user && (user.name || user.username || user.email)) {
                        displayName = user.name || user.username || user.email.split('@')[0];
                        document.querySelector(".page-title").innerText = `Welcome back, ${displayName}!`;
                    }
                } catch (e) {
                    console.log("Auth check error (ignored):", e);
                }

                // Logout logic
                const logoutLinks = document.querySelectorAll(".navbar-link[href='index.html']");
                logoutLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        localStorage.removeItem("user");
                        localStorage.removeItem("token");
                    });
                });

                // Load Ads
                try {
                    const res = await fetch("http://localhost:5000/api/products/marketplace");
                    const products = await res.json();

                    const grid = document.getElementById("adsGrid");
                    grid.innerHTML = "";

                    // Filter only Ads for this section
                    const ads = products.filter(p => p.is_ads == 1);

                    if (ads.length === 0) {
                        grid.innerHTML = "<div style='grid-column: 1/-1; text-align: center; color: #888;'>No recommendations available right now.</div>";
                        return;
                    }

                    ads.forEach(p => {
                        const card = document.createElement("div");
                        card.className = "product-card";
                        card.style.textAlign = "center";
                        card.innerHTML = `
                        <div style="position:relative;">
                            <img src="${p.image_url || 'images/default.png'}" class="product-image"
                                style="width:100%; height:120px; object-fit:cover; border-radius:1em; margin-bottom:1em;">
                            <span style="position: absolute; top: 10px; right: 10px; background: #6366f1; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; font-weight:bold;">SPONSORED</span>
                        </div>
                        <div class="product-info">
                            <h3 class="product-title" style="font-size:1.1em; margin-bottom:0.4em;">${p.name}</h3>
                            <p class="text-muted" style="font-size:0.9rem">Seller: ${p.shop_name}</p>
                            <div style="display:flex;justify-content:space-between;align-items:center;margin:0.5rem 0">
                                <span style="color:#4ade80;font-weight:bold">Rs ${p.price}</span>
                                ${p.coins_percent ? `<span style="color:#f59e0b; font-size:0.8rem;">ü™ô ${p.coins_percent}%</span>` : ''}
                            </div>
                            <button class="btn btn-primary btn-block" style="width:100%">Add</button>
                        </div>
                        `;
                        grid.appendChild(card);
                    });

                } catch (err) {
                    console.error(err);
                }
            });
        </script>

        <!-- Recent Orders -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">Recent Orders (Last 30 days)</h2>
                <a href="orders.html" class="link">View All ‚Üí</a>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Product</th>
                            <th>Date</th>
                            <th>Total</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>#ORD-1234</td>
                            <td>Avocado</td>
                            <td>Oct 1, 2025</td>
                            <td>LKR 9,450</td>
                            <td><a href="feedback.html" class="link">To Receive</a></td>
                        </tr>
                        <tr>
                            <td>#ORD-1235</td>
                            <td>Mushroom</td>
                            <td>Oct 10, 2025</td>
                            <td>LKR 15,960</td>
                            <td><a href="orders.html" class="link">Pending</a></td>
                        </tr>
                        <tr>
                            <td>#ORD-1236</td>
                            <td>Beetroot</td>
                            <td>Oct 12, 2025</td>
                            <td>LKR 4,620</td>
                            <td>
                                <a href="orders.html" class="link"
                                    style="background:#16a34a; color:#fff; padding:0.4em 1em; border-radius:0.5em; font-weight:600; box-shadow:0 2px 8px rgba(22,163,74,0.10); text-decoration:none;">
                                    Pay now
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <td>#ORD-1237</td>
                            <td>Potato</td>
                            <td>Oct 14, 2025</td>
                            <td>LKR 3,780</td>
                            <td><a href="feedback.html" class="link">Leave Feedback</a></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>
    </div>
</body>

</html>