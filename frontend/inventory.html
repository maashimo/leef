<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory - leef üçÉ</title>
    <link rel="stylesheet" href="dashboard.css">
    <style>
        /* Top Navbar Styles (Standardized) */
        .top-navbar {
            background-color: rgba(10, 10, 10, 0.95);
            border-bottom: 1px solid #333;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .navbar-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .navbar-logo {
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: bold;
            color: #4ade80;
        }

        .navbar-nav {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            gap: 2rem;
        }

        .navbar-link {
            text-decoration: none;
            color: #eee;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
        }

        .navbar-link.active {
            background-color: #10b981;
            color: white;
        }

        .navbar-link:hover {
            background-color: #333;
        }

        @media (max-width: 768px) {
            .top-navbar {
                flex-direction: column;
                align-items: flex-start;
            }

            .navbar-nav {
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
            }
        }
    </style>
</head>

<body class="">

    <!-- Navbar -->
    <nav class="top-navbar">
        <div class="navbar-header">
            <a href="index.html" class="navbar-logo">
                leef üçÉ
            </a>
        </div>
        <ul class="navbar-nav">
            <li><a href="seller-dashboard.html" class="navbar-link">Dashboard</a></li>
            <li><a href="inventory.html" class="navbar-link active">Inventory</a></li>
            <li><a href="profile-seller.html" class="navbar-link">Profile</a></li>
            <li><a href="login.html" class="navbar-link" style="color:#ef4444;">Logout</a></li>
        </ul>
    </nav>

    <main class="main-content container" style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <div>
                <h1 class="page-title">Inventory</h1>
                <p class="page-subtitle">Manage your product stock and pricing</p>
            </div>
            <a href="newproduct.html" class="btn btn-primary" style="text-decoration: none;">
                + Add New Product
            </a>
        </div>

        <!-- Inventory Table -->
        <div class="table-container"
            style="background: #1a1a1a; padding: 1rem; border-radius: 12px; border: 1px solid #333;">
            <table class="table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Category</th>
                        <th>Price(Lkr)</th>
                        <th>Stock(kg)</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th>Actions</th>

                    </tr>
                </thead>
                <tbody>
                <tbody id="inventoryBody">
                    <!-- Populated by JS -->
                </tbody>
            </table>
        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const user = JSON.parse(localStorage.getItem("user"));
            if (!user || user.role !== "seller") {
                window.location.href = "login.html";
                return;
            }

            try {
                const res = await fetch(`http://localhost:5000/api/products/seller/${user.id}`);
                const products = await res.json();
                const tbody = document.getElementById("inventoryBody");
                tbody.innerHTML = "";

                if (products.length === 0) {
                    tbody.innerHTML = "<tr><td colspan='5' style='text-align:center;color:#888;'>No products found. Add some!</td></tr>";
                    tbody.innerHTML = "<tr><td colspan='7' style='text-align:center;color:#888;'>No products found. Add some!</td></tr>";
                    return;
                }

                products.forEach(p => {
                    let statusColor, statusText, statusBg;

                    if (p.has_pending_update) {
                        statusColor = "#f97316"; // Orange
                        statusText = "Update Pending";
                        statusBg = "rgba(249, 115, 22, 0.2)";
                    } else if (p.is_approved === 1) {
                        statusColor = "#4ade80"; // Green
                        statusText = "Active";
                        statusBg = "rgba(22, 163, 74, 0.2)";
                    } else if (p.is_approved === 2) {
                        statusColor = "#ef4444"; // Red
                        statusText = "Rejected";
                        statusBg = "rgba(239, 68, 68, 0.2)";
                    } else {
                        statusColor = "#fbbf24"; // Yellow
                        statusText = "Pending";
                        statusBg = "rgba(251, 191, 36, 0.2)";
                    }

                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${p.name}</td>
                        <td>${p.category || 'N/A'}</td>
                        <td>${p.price}</td>
                        <td>${p.stock}</td>
                        <td>${new Date(p.created_at).toLocaleDateString()}</td>
                        <td>
                            <span style="background: ${statusBg}; color: ${statusColor}; padding: 0.3em 0.8em; border-radius: 2em; font-size: 0.85rem; font-weight: 600;">${statusText}</span>
                        </td>
                        <td>
                            <a href="existingproduct.html?id=${p.id}&name=${encodeURIComponent(p.name)}&category=${encodeURIComponent(p.category)}&price=${encodeURIComponent(p.price)}&stock=${encodeURIComponent(p.stock)}" 
                               class="btn" style="background: #333; color: #fff; text-decoration: none; padding: 0.4em 0.8em; border-radius: 6px; font-size: 0.9rem; margin-right: 0.5rem;">Edit</a>
                            <button class="btn" onclick="deleteProduct(${p.id})" style="background: rgba(239, 68, 68, 0.2); color: #ef4444; border: none; padding: 0.4em 0.8em; border-radius: 6px; font-size: 0.9rem; font-weight: 600; cursor: pointer;">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });

            } catch (err) {
                console.error("Failed to fetch inventory", err);
            }
        });

        async function deleteProduct(id) {
            if (!confirm("Are you sure you want to delete this product? This action cannot be undone.")) return;

            const user = JSON.parse(localStorage.getItem("user"));
            if (!user) return;

            try {
                const res = await fetch(`http://localhost:5000/api/products/seller/delete/${id}`, {
                    method: "DELETE",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ sellerId: user.id })
                });

                if (res.ok) {
                    alert("Product deleted successfully");
                    window.location.reload();
                } else {
                    const err = await res.json();
                    alert("Failed to delete: " + (err.message || "Unknown error"));
                }
            } catch (e) {
                console.error(e);
                alert("Server error");
            }
        }
    </script>
    </tbody>
    </table>
    </div>
    </main>
</body>

</html>